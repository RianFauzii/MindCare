<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: header}">
</head>
<body>

<!-- Begin page -->
<div id="wrapper">

    <!-- Topbar Start -->
    <div th:replace="~{layout/header :: topbar}">

    </div>
    <!-- end Topbar -->

    <!-- ========== Left Sidebar Start ========== -->
    <div th:replace="~{layout/header :: navbar}">

    </div>
    <!-- Left Sidebar End -->



    <!-- ============================================================== -->
    <!-- Start Page Content here -->
    <!-- ============================================================== -->

    <div class="content-page">
        <div class="content">

            <!-- Start Content-->
            <div class="container-fluid">

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box">
                            <div class="page-title-right">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="input-group input-group-sm">
                                        <input type="text" class="form-control border" id="dash-daterange" onchange="date(this.value)">
                                        <span class="input-group-text bg-blue border-blue text-white">
                                                    <i class="mdi mdi-calendar-range"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <h4 class="page-title">Beranda</h4>
                        </div>
                    </div>
                </div>
                <!-- end page title -->

                <div class="row">
                    <div class="col-md-6 col-xl-3">
                        <div class="widget-rounded-circle card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-4">
                                        <div class="avatar-lg rounded-circle bg-soft-secondary border-secondary border">
                                            <i class="fe-arrow-down-circle font-22 avatar-title text-primary"></i>
                                        </div>
                                    </div>
                                    <div class="col-8">
                                        <div class="text-end">
                                            <h3 class="text-dark mt-1"><span id="permintaanservice" data-plugin="counterup"></span></h3>
                                            <p class="text-muted mb-1">Permintaan Service</p>
                                        </div>
                                    </div>
                                </div> <!-- end row-->
                            </div>
                        </div> <!-- end widget-rounded-circle-->
                    </div> <!-- end col-->

                    <div class="col-md-6 col-xl-3">
                        <div class="widget-rounded-circle card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-4">
                                        <div class="avatar-lg rounded-circle bg-soft-success border-success border">
                                            <i class="fe-arrow-up-circle font-22 avatar-title text-success"></i>
                                        </div>
                                    </div>
                                    <div class="col-8">
                                        <div class="text-end">
                                            <h3 class="text-dark mt-1"><span id="penyelesaianservice" data-plugin="counterup"></span></h3>
                                            <p class="text-muted mb-1">Penyelesaian Service</p>
                                        </div>
                                    </div>
                                </div> <!-- end row-->
                            </div>
                        </div> <!-- end widget-rounded-circle-->
                    </div> <!-- end col-->

                    <div class="col-md-6 col-xl-3">
                        <div class="widget-rounded-circle card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-4">
                                        <div class="avatar-lg rounded-circle bg-soft-info border-info border">
                                            <i class="fe-bar-chart-line- font-22 avatar-title text-info"></i>
                                        </div>
                                    </div>
                                    <div class="col-8">
                                        <div class="text-end">
                                            <h3 class="text-dark mt-1"><span data-plugin="counterup"></span></h3>
                                            <p class="text-muted mb-1 text-truncate">???</p>
                                        </div>
                                    </div>
                                </div> <!-- end row-->
                            </div>
                        </div> <!-- end widget-rounded-circle-->
                    </div> <!-- end col-->

                    <div class="col-md-6 col-xl-3">
                        <div class="widget-rounded-circle card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-4">
                                        <div class="avatar-lg rounded-circle bg-soft-warning border-warning border">
                                            <i class="fe-eye font-22 avatar-title text-warning"></i>
                                        </div>
                                    </div>
                                    <div class="col-8">
                                        <div class="text-end">
                                            <h3 class="text-dark mt-1"><span data-plugin="counterup"></span>k</h3>
                                            <p class="text-muted mb-1 text-truncate">???</p>
                                        </div>
                                    </div>
                                </div> <!-- end row-->
                            </div>
                        </div> <!-- end widget-rounded-circle-->
                    </div> <!-- end col-->
                </div>


                <div class="row">
                    <div class="col-md-12 col-xl-4">
                        <div class="widget-rounded-circle card">
                            <div class="card-body">
                                <h4 class="card-title text-primary">5 Customer Teratas Sering Service</h4>
                                <div class="row">
                                    <div class="list-group" id="customerteratas">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12 col-xl-4">
                        <div class="widget-rounded-circle card">
                            <div class="card-body">
                                <h4 class="card-title text-success">5 Kendaraan Teratas Sering Diservice</h4>
                                <div class="row">
                                    <div class="list-group" id="kendaraanteratas">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12 col-xl-4">
                        <div class="widget-rounded-circle card">
                            <div class="card-body">
                                <h4 class="card-title text-danger">5 Mekanik Teratas Paling Produktif</h4>
                                <div class="row">
                                    <div class="list-group" id="mekanikteratas">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div> <!-- container -->

        </div> <!-- content -->

        <!-- Footer Start -->
        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <script>document.write(new Date().getFullYear())</script> &copy; A-tech Otocare By <a href="">Kelompok 6</a>
                    </div>
                </div>
            </div>
        </footer>
        <!-- end Footer -->

    </div>

    <!-- ============================================================== -->
    <!-- End Page content -->
    <!-- ============================================================== -->


</div>
<!-- END wrapper -->



<footer th:replace="~{layout/header :: footer}">

</footer>

<script>
    $(document).ready(function(){

        var date = document.getElementById("dash-daterange").value;

        var permintaanservice = getdata("api/raw/permintaanservice",date,date);
        var penyelesaianservice = getdata("api/raw/penyelesaianservice",date,date);
        var customerserviceteratas = getdata("api/raw/customerserviceteratas",date,date);
        var kendaraanserviceteratas = getdata("api/raw/kendaraanserviceteratas",date,date);
        var mekanikteratas = getdata("api/raw/mekanikteratas",date,date);

        loaddata(permintaanservice,penyelesaianservice,customerserviceteratas,kendaraanserviceteratas,mekanikteratas)
    });

    function getdata(url,datebefore,dateafter){
        var result ;
        $.ajax({
            async : false,
            url: "http://localhost:8080/"+url+"?datebefore="+datebefore+"&dateafter="+dateafter,
            method: "GET",
            success: function(data) {
                result = data;
            },
        });
        return result
    }

    function date(value){
        var datebefore;
        var dateafter;

        if(value != ""){
            testdate = value.substring(0,value.indexOf(' '));

            if(testdate != ""){
                datebefore = testdate;
                dateafter = value.substring(value.indexOf(' ')+4);
            }else{
                datebefore = value;
                dateafter = value;
            }

            var permintaanservice = getdata("api/raw/permintaanservice",datebefore,dateafter);
            var penyelesaianservice = getdata("api/raw/penyelesaianservice",datebefore,dateafter);
            var customerserviceteratas = getdata("api/raw/customerserviceteratas",datebefore,dateafter);
            var kendaraanserviceteratas = getdata("api/raw/kendaraanserviceteratas",datebefore,dateafter);
            var mekanikteratas = getdata("api/raw/mekanikteratas",datebefore,dateafter);

            loaddata(permintaanservice,penyelesaianservice,customerserviceteratas,kendaraanserviceteratas,mekanikteratas)

        }
    }

    function loaddata(permintaanservice,penyelesaianservice,customerserviceteratas,kendaraanserviceteratas,mekanikteratas){
        $("#permintaanservice").html(permintaanservice);
        $("#penyelesaianservice").html(penyelesaianservice);

        document.getElementById("customerteratas").innerHTML = "" ;
        if(customerserviceteratas != null) {
            for (var i = 0; i < customerserviceteratas.length; i++) {
                var element = '<div class="list-group-item list-group-item-action">\n' +
                    '<div class="d-flex justify-content-between">\n' +
                    '<img class="d-flex align-self-center me-3 rounded-circle" src="../assets/images/companies/amazon.png" alt="Generic placeholder image" height="64">\n' +
                    '<div class="w-100">\n' +
                    '<h5 class="mb-1"> '+customerserviceteratas[i][1]+'</h5>\n' +
                    '<p class="mb-1"><i class="fe-check-circle"></i> '+customerserviceteratas[i][3]+'</p>\n' +
                    '<p class="mb-1"><i class="fe-phone"></i> '+customerserviceteratas[i][2]+'</p>\n' +
                    '</div>\n' +
                    '</div>\n' +
                    '</div>';

                document.getElementById("customerteratas").innerHTML += element ;
            }
        }

        document.getElementById("kendaraanteratas").innerHTML = "" ;
        if(kendaraanserviceteratas != null) {
            for (var i = 0; i < kendaraanserviceteratas.length; i++) {
                var element = '<div class="list-group-item list-group-item-action">\n' +
                    '<div class="d-flex justify-content-between">\n' +
                    '<img class="d-flex align-self-center me-3 rounded-circle" src="../assets/images/companies/amazon.png" alt="Generic placeholder image" height="64">\n' +
                    '<div class="w-100">\n' +
                    '<h5 class="mb-1"> '+kendaraanserviceteratas[i][3]+'</h5>\n' +
                    '<p class="mb-1"><i class="fe-disc"></i> '+kendaraanserviceteratas[i][2]+'</p>\n' +
                    '<p class="mb-1"><i class="fe-stop-circle"></i> '+kendaraanserviceteratas[i][1]+'</p>\n' +
                    '</div>\n' +
                    '</div>\n' +
                    '</div>';

                document.getElementById("kendaraanteratas").innerHTML += element ;
            }
        }

        document.getElementById("mekanikteratas").innerHTML = "" ;
        if(mekanikteratas != null) {
            for (var i = 0; i < mekanikteratas.length; i++) {
                var element = '<div class="list-group-item list-group-item-action">\n' +
                    '<div class="d-flex justify-content-between">\n' +
                    '<img class="d-flex align-self-center me-3 rounded-circle" src="../assets/images/companies/amazon.png" alt="Generic placeholder image" height="64">\n' +
                    '<div class="w-100">\n' +
                    '<h5 class="mb-1"> '+mekanikteratas[i][1]+'</h5>\n' +
                    '<p class="mb-1"><i class="fe-check-circle"></i> '+mekanikteratas[i][3]+'</p>\n' +
                    '<p class="mb-1"><i class="fe-phone"></i> '+mekanikteratas[i][2]+'</p>\n' +
                    '</div>\n' +
                    '</div>\n' +
                    '</div>';

                document.getElementById("mekanikteratas").innerHTML += element ;
            }
        }
    }
</script>

</body>
</html>